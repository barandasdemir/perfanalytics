!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";
// Copyright (C) 2021 Baran Dasdemir

// This file is part of perfanalytics.

// perfanalytics is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.

// perfanalytics is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.

// You should have received a copy of the GNU General Public License
// along with perfanalytics.  If not, see <http://www.gnu.org/licenses/>.
const e={isAPIAvailable:()=>!!(window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByName&&navigator&&"function"==typeof navigator.sendBeacon&&"function"==typeof fetch),siteID:null,ttfb:null,fcp:null,domLoad:null,windowLoad:null,resources:[]},t="https://barandasdemir-perfanalytics.herokuapp.com",n=e=>e/1e3;if(e.isAPIAvailable()){const{timing:i}=window.performance.toJSON();fetch(`${t}/website/register`,{method:"POST",body:JSON.stringify({origin:window.location.origin}),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((e=>e.json())).then((t=>{e.siteID=t.data.id;const[o]=window.performance.getEntriesByName("first-contentful-paint");e.fcp=n(o.startTime),e.ttfb=n(i.responseStart-i.requestStart),e.domLoad=n(i.domContentLoadedEventEnd-i.navigationStart),e.windowLoad=n(Date.now()-i.navigationStart);const a=window.performance.getEntriesByType("resource");e.resources=a.filter((e=>"fetch"!==e.initiatorType)).map((e=>({name:e.name,duration:n(e.responseEnd-e.requestStart),size:e.decodedBodySize})))})),window.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&navigator.sendBeacon(`${t}/analytic/${e.siteID}`,JSON.stringify(e))}))}}));
